<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>{{ title }}</title>

  <link rel="stylesheet" href="/css/select.css?v={{ last_refresh }}" />

  <style>
    .wrap{ max-width: 1240px; margin: 0 auto; padding: 12px; }
    .topbar{ display:flex; align-items:center; justify-content:space-between; gap:12px; margin: 10px 0 14px; }
    .topbar h1{ margin:0; font-size: 20px; }
    .sub{ opacity:.75; font-size: 13px; }
    .grid{ display:grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 12px; }
    @media (max-width: 920px){ .grid{ grid-template-columns: 1fr; } }
    .card{
      border: 1px solid var(--line, rgba(255,255,255,.14));
      background: rgba(255,255,255,.03);
      border-radius: 16px;
      padding: 12px;
    }
    .head{ display:flex; gap:10px; align-items:center; }
    .ico{
      width: 52px; height: 52px; border-radius: 14px; object-fit: cover;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: 0 10px 20px rgba(0,0,0,.25);
      flex: 0 0 auto;
    }
    .nm{ font-weight: 800; font-size: 16px; margin:0; }
    .body{ margin-top: 10px; display:grid; gap: 8px; line-height: 1.45; }
    .row{ border: 1px solid rgba(255,255,255,.10); border-radius: 14px; padding: 10px; background: rgba(0,0,0,.06); }
    .k{ font-weight: 800; font-size: 13px; opacity: .9; margin-bottom: 4px; }
    .v{ opacity: .92; font-size: 13px; white-space: pre-wrap; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div>
        <h1>{{ title }}</h1>
        <div class="sub">갱신 {{ last_refresh }}</div>
      </div>
      <div style="display:flex; gap:11px; align-items:center;">
        <a class="navbtn" href="/ui/select">메인으로</a>
        <a class="navbtn" href="/refresh">새로고침</a>
      </div>
    </div>

    <div id="list" class="grid"></div>
  </div>

  <script>
    const esc = (s) => (s ?? "").toString()
      .replaceAll("&", "&amp;").replaceAll("<", "&lt;").replaceAll(">", "&gt;")
      .replaceAll('"', "&quot;").replaceAll("'", "&#39;");

    async function loadRunes(){
      const box = document.getElementById("list");
      box.innerHTML = '<div class="card">Loading…</div>';
      try{
        const r = await fetch("/zones/zone-nova/runes", { cache: "no-store" });
        const j = await r.json();
        const runes = Array.isArray(j.runes) ? j.runes : [];
        if (!runes.length){
          box.innerHTML = '<div class="card">룬 데이터가 없습니다.</div>';
          return;
        }

        box.innerHTML = runes.map(x => {
          const icon = x.icon ? `<img class="ico" src="${esc(x.icon)}" alt="">` : `<div class="ico"></div>`;
          return `
            <div class="card">
              <div class="head">
                ${icon}
                <div>
                  <div class="nm">${esc(x.name || "-")}</div>
                  ${x.note ? `<div class="sub">${esc(x.note)}</div>` : ``}
                </div>
              </div>
              <div class="body">
                <div class="row">
                  <div class="k">2 세트</div>
                  <div class="v">${esc(x.twoPiece || "-")}</div>
                </div>
                <div class="row">
                  <div class="k">4 세트</div>
                  <div class="v">${esc(x.fourPiece || "-")}</div>
                </div>
              </div>
            </div>
          `;
        }).join("");
      }catch(e){
        box.innerHTML = `<div class="card">불러오기 실패: ${esc(e?.message || String(e))}</div>`;
      }
    }

    loadRunes();
  </script>
</body>
</html>
