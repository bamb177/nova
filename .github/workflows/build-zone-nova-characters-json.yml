name: Sync Zone Nova characters (RAW)

on:
  # 사용자가 "주기 실행하지 않음"을 명확히 했으므로 수동 실행만 둔다.
  workflow_dispatch:

permissions:
  contents: write

concurrency:
  group: sync-zone-nova-characters-raw
  cancel-in-progress: true

jobs:
  sync:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout (your repo)
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: "20"

      # 원본 데이터를 가져오는 단계
      # - 여기 URL은 현재 예시이며, 실제로 사용하는 upstream repo로 바꾸면 된다.
      - name: Clone upstream repository
        run: |
          git clone --depth 1 https://github.com/boring877/gacha-wiki.git _upstream_gachawiki

      # 변환 없이(=주석/포맷 그대로) 원본 파일을 public/data로 복사
      - name: Sync RAW JS/TS (no transform, keep comments)
        env:
          ZONE_NOVA_SEARCH_ROOT: _upstream_gachawiki
        run: node scripts/sync_zone_nova_characters_raw.mjs

      # 변경 사항이 있으면 커밋/푸시
      - name: Commit & push if changed
        run: |
          if git diff --quiet; then
            echo "No changes to commit."
            exit 0
          fi

          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

          git add public/data/zone-nova/characters
          git commit -m "sync(zone-nova): update characters (raw upstream)"
          git push
