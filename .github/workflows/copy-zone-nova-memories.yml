name: Copy Zone Nova Memories Images to Public Card

on:
  workflow_dispatch:
  schedule:
    # 매일 03:20 KST = 18:20 UTC
    - cron: "20 18 * * *"

permissions:
  contents: write

concurrency:
  group: copy-zone-nova-memories-to-public-card
  cancel-in-progress: true

jobs:
  copy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Copy memories -> public card
        shell: bash
        run: |
          set -euo pipefail

          SRC="src/assets/images/games/zone-nova/memories"
          DST="public/images/games/zone-nova/card"

          if [ ! -d "$SRC" ]; then
            echo "[SKIP] Source folder not found: $SRC"
            exit 0
          fi

          mkdir -p "$DST"

          # 완전 동기화(미러링): SRC에 없는 파일은 DST에서도 삭제됨
          rsync -av --delete "$SRC"/ "$DST"/

      - name: Commit & push if changed
        shell: bash
        run: |
          set -euo pipefail

          if git status --porcelain | grep -q .; then
            git config user.name "github-actions[bot]"
            git config user.email "github-actions[bot]@users.noreply.github.com"

            git add public/images/games/zone-nova/card
            git commit -m "Copy memories images to public card"
            git push
          else
            echo "[NO CHANGES] Nothing to commit."
          fi
